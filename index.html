dayNotes.forEach(function(note, index) {
                        const noteDiv = document.createElement('div');
                        noteDiv.className = 'note-item';
                        noteDiv.innerHTML = 
                            '<span class="note-text">' + note.text + '</span>' +
                            '<button class="note-delete" onclick="deleteOneNote(' + index + ')">Удалить</button>';
                        listDiv.appendChild(noteDiv);
                    });
                    
                    notesList.appendChild(listDiv);
                }
            }
            
            const noteInput = document.getElementById('noteInput');
            if (noteInput) {
                noteInput.value = '';
            }
            
            const modal = document.getElementById('modal');
            if (modal) {
                modal.style.display = 'flex';
            }
        }

        function closeModal() {
            const modal = document.getElementById('modal');
            if (modal) {
                modal.style.display = 'none';
            }
            selectedDate = null;
        }

        function saveNote() {
            if (!selectedDate) return;
            
            const noteInput = document.getElementById('noteInput');
            if (!noteInput) return;
            
            const text = noteInput.value.trim();
            if (!text) {
                closeModal();
                return;
            }
            
            const dateKey = formatDateKey(selectedDate);
            
            if (!notes[dateKey]) {
                notes[dateKey] = [];
            }
            
            const now = new Date();
            const timeStr = String(now.getHours()).padStart(2, '0') + ':' + String(now.getMinutes()).padStart(2, '0');
            
            notes[dateKey].push({
                text: text,
                time: timeStr
            });
            
            try {
                localStorage.setItem('calendarNotes', JSON.stringify(notes));
            } catch (e) {
                console.error('Ошибка сохранения:', e);
            }
            
            renderCalendar();
            openModal(selectedDate);
        }

        function deleteOneNote(index) {
            if (!selectedDate) return;
            
            const dateKey = formatDateKey(selectedDate);
            
            if (notes[dateKey]) {
                notes[dateKey].splice(index, 1);
                
                if (notes[dateKey].length === 0) {
                    delete notes[dateKey];
                }
                
                try {
                    localStorage.setItem('calendarNotes', JSON.stringify(notes));
                } catch (e) {
                    console.error('Ошибка сохранения:', e);
                }
                
                renderCalendar();
                openModal(selectedDate);
            }
        }

        function prevMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar();
        }

        function nextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar();
        }
    </script>
</body>
</html>
